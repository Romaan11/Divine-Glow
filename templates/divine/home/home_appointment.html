{% load static %}

<style>
.appointment-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.43);
    z-index: 1;
}

.appointment-content {
    position: relative;
    z-index: 2;
}

.opening-hours-glass {
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(3px);
    color: #ffffffe8;
}

.appointment-form input,
.appointment-form textarea,
.appointment-form select {
    width: 100%;
    padding: 12px 15px;
    border-radius: 6px;
    background: rgba(0, 0, 0, 0.35);
    color: #fff;
    border: 1px solid #ffffff;
    outline: none;
}

.appointment-form input::placeholder,
.appointment-form textarea::placeholder,
.appointment-form select::placeholder {
    color: #fff;
}

.appointment-form select.form-select {
    background: rgba(0, 0, 0, 0.35) !important;
    color: #fff !important;
    appearance: none;
    -webkit-appearance: none;
}

.appointment-form select option {
    color: #000;
}

.appointment-form input[type="time"]::-webkit-calendar-picker-indicator {
    filter: invert(1); /* This changes the color of the time icon */
}

.appointment-form input[type="time"] {
    background: rgba(0, 0, 0, 0.35) !important;
    color: #fff !important;
    border: 1px solid #ffffff !important;
}

.flatpickr-input[readonly] {
    background: rgba(0, 0, 0, 0.35) !important;
    color: #fff !important;
    border: 1px solid #ffffff !important;
}

.appointment-form .btn-primary {
    background-color: #FF99BB;
    border-color: #FF99BB;
    transition: all 0.3s ease;
}

.appointment-form .btn-primary:hover {
    background-color: #884CD2;
    border-color: #884CD2;
    color: #fff;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(136, 76, 210, 0.4);
}

.appointment-form select option {
    background-color: rgba(0, 0, 0, 0.74) !important;
    color: #ffffff;
}
</style>

<div class="container-fluid appointment py-5 position-relative"
     style="background: url('{% static "img/appointment-background.jpg" %}') center/cover no-repeat;">

    <div class="appointment-overlay"></div>

    <div class="container py-5 appointment-content">
        <div class="row g-5 align-items-center">

            <div class="col-lg-6">
                <div class="appointment-form p-5 rounded"
                     style="background: rgba(0,0,0,0.65); backdrop-filter: blur(6px);">

                    <p class="fs-4 text-uppercase text-primary">Get In Touch</p>
                    <h1 class="display-4 mb-4 text-white">Get Appointment</h1>

                    <form method="POST" action="{% url 'appointment' %}" autocomplete="off">
                        {% csrf_token %}

                        <div class="row gy-3 gx-4">
                            <div class="col-lg-6">{{ form.name }}</div>
                            <div class="col-lg-6">{{ form.email }}</div>
                            <div class="col-lg-6">{{ form.phone }}</div>
                            <div class="col-lg-6">{{ form.preferred_date }}</div>
                            <div class="col-lg-6">{{ form.service }}</div>
                            <div class="col-lg-6">{{ form.preferred_time }}</div>
                            <div class="col-lg-12">{{ form.message }}</div>

                            <div class="col-lg-12">
                                <button type="submit" class="btn btn-primary w-100 py-3 px-5">
                                    SUBMIT NOW
                                </button>
                            </div>
                        </div>
                    </form>

                </div>
            </div>

            <div class="col-lg-6">
                <div class="appointment-time p-5 rounded opening-hours-glass">
                    <h1 class="display-5 mb-4">Opening Hours</h1>

                    <div class="d-flex justify-content-between fs-5"><p>Saturday:</p><p>09:00 am – 10:00 pm</p></div>
                    <div class="d-flex justify-content-between fs-5"><p>Sunday:</p><p>09:00 am – 10:00 pm</p></div>
                    <div class="d-flex justify-content-between fs-5"><p>Monday:</p><p>09:00 am – 10:00 pm</p></div>
                    <div class="d-flex justify-content-between fs-5"><p>Tuesday:</p><p>09:00 am – 10:00 pm</p></div>
                    <div class="d-flex justify-content-between fs-5"><p>Wednesday:</p><p>09:00 am – 08:00 pm</p></div>
                    <div class="d-flex justify-content-between fs-5"><p>Thursday:</p><p>09:00 am – 05:00 pm</p></div>
                    <div class="d-flex justify-content-between fs-5"><p>Friday:</p><p>CLOSED</p></div>

                    <p class="mt-3 text-muted" style="color:black!important;">
                        Check out seasonal discounts for best offers.
                    </p>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

    const dateInput = document.getElementById("id_preferred_date");
    const timeInput = document.getElementById("id_preferred_time");

    if (dateInput) {
        fetch("{% url 'booked_slots' %}")
            .then(res => res.json())
            .then(bookedData => {
                flatpickr(dateInput, {
                    minDate: "today",
                    altInput: true,
                    altFormat: "F j, Y",
                    dateFormat: "Y-m-d",
                    disable: Object.keys(bookedData),
                    onChange: function (selectedDates, dateStr) {
                        if (timeInput) {
                            timeInput.value = "";
                            timeInput.dataset.booked =
                                bookedData[dateStr] ? bookedData[dateStr].join(",") : "";
                        }
                    }
                });
            });
    }

});
</script>
